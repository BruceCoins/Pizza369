## 一、ETH 概述
1> 缩短出块时间   
2> Proof of work（工作量证明） ---> Proof of stake（权益证明） 
3> 智能合约  

## 二、ETH 账户  
基于账户的模型 ---> 重放攻击(解决：交易nonce计数器、链ID、签名包含唯一信息)  

外部账户：公钥、私钥钥对控制（包括：账户余额、nonce计数器）  
合约账户：不能发起交易，只能由外部账户发起交易。但是可以调用另外一个合约（包括：balance、nonce、代码code、相关状态storage）  

## 三、ETH 状态树  
账户地址：160位 十六进制显示40位  
### 【1】 trie（前缀树）数据结构  
```
     ( )
   /  |  \
  t   a   i
 / \       \
o    e      n
   / | \   /
  a  d  n  n 
```
上图是一棵 ``Trie`` 树，表示了关键字集合 ``{“a”, “to”, “tea”, “ted”, “ten”, “i”, “in”, “inn”} ``。  

- **Trie 树的基本特点：**

<1> 每个节点的分支数目取决于这个 key 值里每个元素的取值范围（上例中**为26个字母+1个结束标志位**，ETH地址是 0~f共16+1个结束标志位）  
<2> Trei的查找效率取决于 Key 的长度，key 值越长，访问内存的次数越多（ETH地址长度40位十六进制）  
<3> 不会出现 Hash 碰撞  
<4> 只要输入不变，输入顺序不会影响 Trie 构成同一棵树  
<5> ETH 账户通常只对有交易的部分账户进行更新，Trie 的局部更新很好  

- **Trie 树的基本性质：**  

<1> 根节点不包含字符，除根节点外的每一个子节点都包含一个字符。  
<2> 从根节点到某一个节点，路径上经过的字符连接起来，为该节点对应的字符串。  
<3> 每个节点的所有子节点包含的字符互不相同。  

通常在实现的时候，会在节点结构中设置一个标志，用来标记该结点处是否构成一个单词（关键字）。  

### 【2】Patricia Tree（压缩前缀树） --- Trie 升级版  
单词 abc、abf、adrf、siab 结构：
```
压缩前：                         压缩后：
        ( )                           ()
       /   \                         /  \
     a      s                      a    siab
    / \      \                    /  \
   b   d      i                  b    drf 
  / \   \      \                / \
 c   f   r      a              c   f
          \      \
           f      b
```
- **Patricia Tree 优点：**  
<1> 树的高度降低，查询效率提高

- **缺点**
<1> 添加新单词时，压缩的分支可能需要展开

### 【3】modify Merkle Patricia Tree(modify MPT)  ---- Trie 的二次升级   
![Modify MPT](https://github.com/BruceCoins/Pizza369/blob/main/0x0007%20read%20code/%E8%82%96%E8%87%BB%20%E3%80%8A%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8%E3%80%8B/images/modify%20MPT.png)   
**1.Block Header (区块头):**  

区块头是区块链中每个区块的元数据部分，包含该区块的关键信息。  

**2.stateRoot (状态根):**  

是一个 Keccak 256 位的哈希值。它是状态树的根节点的哈希值，记录了所有交易执行和最终化后的状态。

**3.Keccak 256-bit hash:**  

一种加密哈希函数（KECCAK256()），用于生成固定长度的哈希值（256 位）。
图中的 stateRoot 就是通过这个函数计算得出的。

**4.World State Trie (世界状态树):**  

是一种树状数据结构，用于存储区块链中所有账户的状态。  
它由多种节点类型组成，包括扩展节点（Extension Node）、分支节点（Branch Node）和叶子节点（Leaf Node）。  

**5.World State Trie 的节点类型:**  

- Extension Node (扩展节点):  
用于共享公共前缀的节点。例如，根节点是一个扩展节点，**前缀**为 0，共享的 nibble（半字节）为 a7。  
- Branch Node (分支节点):  
包含 16 个子节点（0-f）和一个可选的值。用于进一步分支到其他节点。  
- Leaf Node (叶子节点):  
存储最终的键值对。例如，prefix key-end value 表示叶子节点的前缀、键的结束部分和对应的值。  

**6.Prefixes (前缀):**  

用于区分节点类型的标识符：  
0：扩展节点（偶数个 nibble）。  
10：扩展节点（奇数个 nibble）。  
2：叶子节点（偶数个 nibble）。  
30：叶子节点（奇数个 nibble）。  

**7.Nibble (半字节):**  

4 位的数据单位（1 nibble = 4 bits）。  
示例值:  
例如，a711355 对应的值是 45.0 ETH，a77d337 对应的值是 1.00 WEI。  

