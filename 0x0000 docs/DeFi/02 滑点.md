## 一、滑点  
### 1、定义:  
滑点是指用户**实际成交价格**与**预期交易价格**之间的差异。在DEX中，滑点通常由流动性不足或大额交易导致。  

### 2、举例说明：  
假设要在 Uniswaop 上用 ETH 兑换 DAI：  

- **预期价格：**  1ETH = 2000DAI
- **交易量：** 用 5ETH 兑换 DAI (预期兑换 10,000 DAI )
- **恒定乘积公式：** xy = k，令 x 表示 ETH， y 表示 DAI  

但当前流动性池中仅有 5 ETH 和 10,000 DAI （按1:2000比例）。根据 AMM 的恒定乘积公式，大额交易会显著改变池子中的资产比例:  

- **【1】投入 5 ETH 后，池子变为：**  
  -  ETH = 5 + 5 = 10
  -  DAI = 10,000
  -  **新的** k = 10 $\times$ 10,000 = 100,000
    
- 【2】**可以得到的 DAI 数量为($\Delta x表示投入的 ETH，\Delta y 表示可兑换的 DAI$)：**
  - $(x + \Delta x)(y - \Delta y) = k$ 
  - $\Delta y(即DAI) = 10,000 - \frac{100,000}{10} = 10,000 - 10,000 = 0$

实际上， AMM会按照滑点容忍度（如1%）部分执行交易。  

## 二、滑点计算方法  
在 AMM（如Uniswap）中，滑点直接来源于 [**恒定乘积公式：**](https://github.com/BruceCoins/Pizza369/blob/main/0x0000%20docs/DeFi/01%20%E8%AF%A6%E8%A7%A3%E6%81%92%E5%AE%9A%E4%B9%98%E7%A7%AF%E5%85%AC%E5%BC%8F.md) $x \times y = k$  
设用户用 $\Delta x$ 数量的代币 A 购买代币 B，实际获得的代币 B 数量为 $\Delta y$，则滑点计算如下：  

### 1、预期价格：  

初始池中 代币A 和 代币B 的比例决定预期价格： $P_{预期} = \frac{y}{x}$   

### 2、实际成交价格：

交易后，实际价格为： $P_{实际} = \frac{y - \Delta y}{ x + \Delta x}$

### 3、滑点（百分比）：

滑点定义为 实际价格 与 预期价格 的偏差比例： $滑点 = \left\vert\frac{P_{实际} - P_{预期}}{P_{预期}}\right\vert\times 100\\%$

### 4、举例说明：  
```
假设 ETH / DAI 流动性池：
（1）初始状态：x = 10ETH, y = 20,000DAI, k = 2,000（每个 ETH 可以兑换的 DAI 数量）
（2）用户想用 1ETH 购买 DAI
```
#### 第1步：计算预期价格  
 &emsp;&emsp;&emsp;&emsp; $P_{预期} = \frac{y}{x} = \frac{20,000}{10} = 2,000 \\ DAI / ETH$  

#### 第2步：计算实际获得的DAI($\Delta y$)  
 &emsp;&emsp;&emsp;&emsp; 根据恒定乘积公式： $(x + \Delta x)(y - \Delta y) = k$  
  
 &emsp;&emsp;&emsp;&emsp; 带入数值： (10 + 1)(20,000 - $\Delta y$) = 200,000   
  
 &emsp;&emsp;&emsp;&emsp; 解的： $\Delta y = 20,000 - \frac{200,000}{11} \approx 1818.18 \\ DAI$   

#### 第3步：计算实际成交价格  
 &emsp;&emsp;&emsp;&emsp; $P_{实际} = \frac{\Delta y}{\Delta x} = \frac{1818.18}{1} \approx 1818.18 \\ DAI / ETH$

#### 第4步：计算滑点  
 &emsp;&emsp;&emsp;&emsp; 滑点 = $\left\vert\frac{1818.18 - 2000}{2000}\right\vert \times 100 \\% \approx 9.09\\%$

- 结论：用户因大额交易（占池子的10%），滑点高达 9.09%

## 三、滑点通用公式（仅与交易量有关）

对于**任意交易量** $\Delta x$ 滑点公式可表示为：  

&emsp;&emsp;&emsp;&emsp; &emsp;&emsp;&emsp;&emsp;  **滑点 = $\Bigg( \frac{\Delta x}{x + \Delta x}\Bigg) \times 100\\% $**  

### ● **推导过程**  
设流动性池初始状态为(x,y)，恒定乘积 x·y = k，用户用 $\Delta x$ 的代币 A 购买代币 B，实际获得 $\Delta y$ 数量的代币 B

**（1）交易后的池子状态：**  
&emsp;&emsp;&emsp;&emsp;   用户使用的 代币A 数量： $\Delta x$  

&emsp;&emsp;&emsp;&emsp;   用户获得的 代币B 数量： $\Delta y \approx \frac{\Delta x · y}{x + \Delta x} $  

**（2）预期价格与实际价格：**   

&emsp;&emsp;&emsp;&emsp; 预期价格（交易前）： $P_{预期} = \frac{y}{x}$   

&emsp;&emsp;&emsp;&emsp; 实际价格（交易后）： $P_{实际} = \frac{\Delta y}{\Delta x} = \frac{y}{x + \Delta x}$    

**（3）滑点公式：**   
滑点是实际价格与预期价格的偏离百分比： $滑点 = \left\vert\frac{P_{实际} - P_{预期}}{P_{预期}}\right\vert\times 100\\%$   

代入证得： $\left\vert \frac{\frac{y}{x + \Delta x} - \frac{y}{x}}{\frac{y}{x}} \right\vert \times 100\\% =  \left\vert \frac{x - (x + \Delta x)}{x + \Delta x} \right\vert \times 100\\% = \Bigg( \frac{\Delta x}{x + \Delta x} \Bigg)\times 100\\%$

## 四、滑点的影响因素  

#### 1、交易量占池子的比例  
- **交易量越大，滑点越高**  
  例如：用 5ETH 购买 DAI（占池子的 50%），滑点会飙升至**约50%**

#### 2、流动性池深度  
- **流动性越深（k越大），滑点越低**  
  若池子有 100ETH 和 200,000 DAI（k = 20,000,000），用 1ETH 交易的滑点仅约 0.9%

#### 3、多跳交易（聚合器优化）  
- 通过拆分交易路径（如 ETH -> USDC -> DAI），可降低滑点。工具如 1inch、Matcha 会自动优化

## 五、如何减少滑点   
**（1）分拆大额交易：** 将单笔交易拆分为多笔小额交易。   
**（2）选择高流动性池：** 如 Uniswap 的 ETH/USDC 池比小众代币池滑点低。   
**（3）设置滑点容忍度：** 交易时设置最大滑点（如1%），避免意外损失。   
**（4）使用Layer 2：** 在 Arbitrum、Optimism 上交易，Gas 费更低，流动性更集中。   
