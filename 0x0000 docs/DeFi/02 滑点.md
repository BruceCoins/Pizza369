## 一、滑点  
### 1、定义:  
滑点是指用户**实际成交价格**与**预期交易价格**之间的差异。在DEX中，滑点通常由流动性不足或大额交易导致。  

### 2、举例说明：  
假设要在 Uniswaop 上用 ETH 兑换 DAI：  

- **预期价格：**  1ETH = 2000DAI
- **交易量：** 用 5ETH 兑换 DAI (预期兑换 10,000 DAI )
- **恒定乘积公式：** xy = k，令 x 表示 ETH， y 表示 DAI  

但当前流动性池中仅有 5 ETH 和 10,000 DAI （按1:2000比例）。根据 AMM 的恒定乘积公式，大额交易会显著改变池子中的资产比例:  

- **【1】投入 5 ETH 后，池子变为：**  
  -  ETH = 5 + 5 = 10
  -  DAI = 10,000
  -  **新的** k = 10 $\times$ 10,000 = 100,000
    
- 【2】**可以得到的 DAI 数量为($\Delta x表示投入的 ETH，\Delta y 表示可兑换的 DAI$)：**
  - $(x + \Delta x)(y - \Delta y) = k$ 
  - $\Delta y(即DAI) = 10,000 - \frac{100,000}{10} = 10,000 - 10,000 = 0$

实际上， AMM会按照滑点容忍度（如1%）部分执行交易。  

## 二、滑点计算方法  
在 AMM（如Uniswap）中，滑点直接来源于 ![**恒定乘积公式：**](https://github.com/BruceCoins/Pizza369/blob/main/0x0000%20docs/DeFi/01%20%E8%AF%A6%E8%A7%A3%E6%81%92%E5%AE%9A%E4%B9%98%E7%A7%AF%E5%85%AC%E5%BC%8F.md) $x \times y = k$  
设用户用 $\Delta x$ 数量的代币 A 购买代币 B，实际获得的代币 B 数量为 $\Delta y$，则滑点计算如下：  

### 1、预期价格：  

初始池中 代币A 和 代币B 的比例决定预期价格： $P_{预期} = \frac{y}{x}$   

### 2、实际成交价格：

交易后，实际价格为： $P_{实际} = \frac{y - \Delta y}{ x + \Delta x}$

### 3、滑点（百分比）：

滑点定义为 实际价格 与 预期价格 的偏差比例： $滑点 = |\frac{P_{实际} - P_{预期}}{P_{预期}}| \times 100\\%$

### 4、举例说明：  
```
假设 ETH / DAI 流动性池：
（1）初始状态：x = 10ETH, y = 20,000DAI, k = 2,000（每个 ETH 可以兑换的 DAI 数量）
（2）用户想用 1ETH 购买 DAI
```
#### 第1步：计算预期价格  
 &emsp;&emsp;&emsp;&emsp; $P_{预期} = \frac{y}{x} = \frac{20,000}{10} = 2,000 \\ DAI / ETH$  

#### 第2步：计算实际获得的DAI($\Delta y$)  
 &emsp;&emsp;&emsp;&emsp; 根据恒定乘积公式： $(x + \Delta x)(y - \Delta y) = k$  
  
 &emsp;&emsp;&emsp;&emsp; 带入数值： (10 + 1)(20,000 - $\Delta y$) = 200,000   
  
 &emsp;&emsp;&emsp;&emsp; 解的： $\Delta y = 20,000 - \frac{200,000}{11} \approx 1818.18 \\ DAI$   

#### 第3步：计算实际成交价格  
 &emsp;&emsp;&emsp;&emsp; $P_{实际} = \frac{\Delta y}{\Delta x} = \frac{1818.18}{1} \approx 1818.18 \\ DAI / ETH$

#### 第4步：计算滑点  
 &emsp;&emsp;&emsp;&emsp; 滑点 = $|\frac{1818.18 - 2000}{2000}| \times 100 \\% \approx 9.09\\%$
