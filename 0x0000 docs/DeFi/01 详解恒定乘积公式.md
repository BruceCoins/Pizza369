## 恒定乘积公式（Constant Product Formula）详解  
恒定乘积公式（x · y = k）是自动做市商（AMM）的核心算法，最早由 Uniswap V1/V2 采用。它通过舒徐规则确保交易对流动性池中两种资产数量的乘积始终保持不变，从而自动计算交易价格并维持市场平衡。  

### 公式定义  
对于交易对，如 ETH / DAI ：
- x = ETH 数量
- y = DAI 数量
- k = 恒定乘积（常数）          
- p =  $$\frac{y}{x}$$ （每个 ETH 可兑换的 DAI 数量）    

公式表示为： **x · y = k**  
**核心规则：** 任何交易必须保证交易结束后的 $$x' \cdot y' = k$$   

### 交易价格计算  
- 当用户使用 $\Delta x$ 数量的 ETH 购买 $\Delta y$ 的数量 DAI 时，**新的池子**状态需满足(保持 k 不变)：
  $(x + \Delta x) \cdot (y - \Delta y) = k$

- 解出 $\Delta y$ （用户获得的 DAI 数量）：
  $\Delta y = y - \frac{k}{x + \Delta x}$

- 由于 $k = x \cdot y $，代入后得： $\Delta y = y - \frac{x \cdot y}{x + \Delta x} = \frac{y \cdot \Delta x}{x + \Delta x} $   

**实际价格：**  
用户用$\Delta x$ 个 ETH 兑换 $\Delta y$ 个 DAI，实际成交价为：
价格 = $\frac{\Delta y}{\Delta x} = \frac{y}{x = \Delta x}$
